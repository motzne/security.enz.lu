# Hacking\#Cracking\#Malware

## Bedrohungslage / Terminologie

![](../.gitbook/assets/image%20%28107%29.png)

| Begriff                | Bedeutung                                                                                                                                             |
| :--------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------- |
| Malware                | **mal**icious ‚bösartig‘ und soft**ware**. Bösartige Software z.B. auch Viren. Bsp. Rootkit = Komplette Rechteübernahme "Root" eines Betriebssystem   |
| Web Based Attack       | Vom Server ausgehend                                                                                                                                  |
| Web Application Attack | SQL-Injection, XSS, usw. an eine Applikation                                                                                                          |
| Phishing               | Versuche, über gefälschte Webseiten, E-Mails oder Kurznachrichten an persönliche Daten eines Internet-Benutzers zu gelangen =&gt; Identitätsdiebstahl |
| Denial of Service      | Nichtverfügbarkeit eines Internetdienstes, der eigentlich verfügbar sein sollte. Häufigster Grund ist die Überlastung des Datennetzes                 |
| SPAM                   | Spam-Emails versenden                                                                                                                                 |
| Botsnets               | Verbund von infizierten Rechner, welche gesteuert werden können                                                                                       |
| Ransomware             | Erpressungstrojaner, Erpressungssoftware, Kryptotrojaner oder Verschlüsselungstrojaner, sind Schadprogramme                                           |
| Cryptojacking          | Ungewolltes Mining von Cryptocurrencies auf einem Rechner                                                                                             |

## Botnetze

Ein Botnetz ist ein Verbund von infizierten Rechnern \(Bots\), die von einem zentralen Rechner \(Botmaster\) gesteuert werden. Die Infizierung wird durch Malware erreicht und die Steuerung erfolgt meist über einen Passwort geschützten Chatkanal \(IRC, HTTP\).

![](../.gitbook/assets/image%20%2890%29.png)

### Wozu werden Botnetze verwendet ?

- Anonymisierung: Verbergen des Ursprungs von Angriffen
- SPAM Versand
- Versand von Phishing Mails
- Distributed Denial of Service Angriffe
- Sniffen \(z.B. von Passwörtern\) im grossen Stil

### Bekämpfung:

Wenn Bots über ein Chatprotokoll gesteuert werden, bietet der Chatserver einen Angriffspunkt. Darum werden immer mehr Botnetze über P2P gesteuert.

## Denial of Service \(DoS\)

in Denial of Service Angriff hat zum Ziel, die Verfügbarkeit eines Dienstes, eines Rechners oder einer Netzwerkressource zu stören:

- überfluten
  - Bandbreite
  - Anzahl Verbindungen
- abstürzen lassen

#### Mitigation:

- Monitoring der Dienste \(von aussen\), nicht dass es der Kunde/Chef bemerkt
- SLA mit Provider \(z.B. Protection mit Swisscom\)
- Einsatz von DDoS-Prevention Dienst \(Cloudflare\)
- Krisenmgmt. \(Helpdesk, Checkliste\)

### Booters

Ein **booter shell script** ist ein Skript in PHP/ASP/Perl, um Datenverkehr zu generieren. Diese Skripte befinden sich typischerweise auf kompromittierten Webseiten.

### \(Reflected\) DDoS Strategien

- Smurf Attacke: Ein fehlerhaft konfigurierter Router beachtet PING Anfragen auf seinem Broadcast Port. Was tun Sie als Hacker ?
- **PING** Flood: Bots senden zeitgleich Pings an einen Host
- **SYN** Flood: Bots bauen zeitgleich eine TCP Verbindung zum Host auf und brechen ab, ohne ACK zu senden. Host wartet auf Antwort.

![](../.gitbook/assets/image%20%2897%29.png)

### Distributed Reflection Denial of Service Angriff \(DRDoS\)

- Kein Bedarf für ein botnet; man verwendet bestehende Server mit UDP Diensten.
- Einige Dienste können missbraucht werden, da diese die Anfrage verstärken: DNS, NTP, memcached, ...  
   1 kleine Anfrage rein, 1 grosse Antwort raus

  • TypischeVerstärkungsfaktoren:

  - DNS: ~50-100
  - NTP: ~500-5’000
  - Memcached: ~10’000-500’000

## Bufferoverflow / Pufferüberlauf

Im Wesentlichen werden bei einem Pufferüberlauf durch Fehler im Programm zu große Datenmengen in einen dafür zu kleinen reservierten [Speicherbereich](https://de.wikipedia.org/wiki/Speicherbereich) – den [Puffer](https://de.wikipedia.org/wiki/Puffer_%28Informatik%29) oder [Stapel](https://de.wikipedia.org/wiki/Stapelspeicher) – geschrieben, wodurch nach dem Ziel-Speicherbereich liegende Speicherstellen überschrieben werden.

![](../.gitbook/assets/image%20%2895%29.png)

gets ist eine Funktion der C und C++ Standardbibliothek. Sie liest eine Zeile vom Standard-In und speichert die Zeichen im Argument. Hier ist die Zeilenlaenge auf 1000 limitiert. Adresse = 4 Zeichen. Die letzten 4 Zeichen ueberschreiben also die Ruecksprungadresse. Dabei koennten die ersten 1000 Zeichen ein Schadprogramm \(z.B. Starten eines Wurms\) darstellen.

Mitigation \(Compiler; Betriebssystem\):

- Stack Cookie
- Non-Executable Stack \(DEP\)
- Address Space Layout Randomization \(ASLR\)
- Control Flow Guard \(CFG\)

## Malware:

Malware = Malicious Software.

### Zusammenfassung

- Der Betrüger benötigt öffentlich zugängliche Server, um

  - die Login-Informationen des Opfers zu erhalten
  - Aktualisierungen von Software/Konfiguration zu verteilen

  =&gt; benötigt wartungsfreundliche und widerstandfähige Netzwerkinfrastruktur

- Der Betrüger benötigt einen Mechanismus, um

  - Persistenz auf den infizierten Hosts zu sichern
  - Antiviren-Lösungen zu umgehen

  =&gt; effiziente \(und effektive\) Infektion der Hosts

### Typische Klassen

![](../.gitbook/assets/image%20%285%29.png)

### Typische Funktionalität

- Backdoor
- CryptoMiner/Stealer
- ClickFraud
- DoS
- Downloader/Dropper
- Ransomware
- RemoteAccessTool
- Scareware
- Spam-Engine
- Spyware\(Banker, CredentialStealer, Keylogger, Sniffer\)

### Ransomware

PC/Smartphone und/oder verschlüsselt vorhandene Daten. Zur Freischaltung bzw. Entschlüsselung muss man zahlen: SFr. 500-1500 sind übliche Beträge für Privatpersonen.

#### Mitigation:

Offline Backups!

### Bankentrojaner / Retefe

erstellt oder manipuliert Zahlungsaufträge im Namen des Opfers. Zwei-Faktor-Authentifizierung kann umgangen werden – entweder technisch oder via social engineering.  
Problem

- DNS wird umgeleitet
- HTTPS trotzdem aktiv \(eigenes Self-Signed-Cert. installiert, oder Domain anders\)

![](../.gitbook/assets/image%20%2865%29.png)

### Netzwerk

#### Fastflux

![](../.gitbook/assets/image%20%2815%29.png)

**Problem:**  
Eine fixe IP-Adresse \(evtl. aufgelöst über einen C&C-Domainnamen\) kann von ISPs gefiltert werden – auch IP-Adressen von Cyberbunker.

**Mitigation:**

- Single: Die DNS-Query auf den C&C-Domainnamen löst alle halbe Stunde auf einen anderen Bot im Botnetz auf, welcher als Proxy zum eigentlichen C&C-Server dient.
- Double \(nicht im Rahmen dieser Vorlesung\): Der autoritative DNS-Server für den C&C-Domainnamen ist ein Bot im Botnetz. Dieser wechselt regelmässig \(z.B. alle 2 Stunden\).

#### Peer-To-Peer \(P2P\)

Dezentrale \(P2P\) Infrastruktur hat keinen zentralen Knoten und ist daher schwierig zu bekämpfen.

![](../.gitbook/assets/image%20%2869%29.png)

**Mitigation:**  
Double-layer Dynamic Trust \(DDT\) management scheme

#### Domains

**Problem**

- DGA: In Abhängigkeit des Datum, eines Devisenkurses oder auch einfach nur eines fix-kodierten Wertes im Trojaner wird eine Reihe von Domainnamen generiert \(zB 1000 Stück\). Registriert werden aber nur einer oder zwei davon. Die Malware geht alle durch, bis eine erfolgreiche Kontaktaufnahme gelingt.
- Blockchain-based Domains
  - .bit \(Namecoin\)
  - .bazar, .coin, .emc, .lib \(Emercoin\)
- TOR/I2P
  - - Tor Hidden Services \(.onion\)
    - Eepsites \(.i2p\)

**Lösung**

- Wenige vorhanden, Komplexität für den Bot nimmt zu
- Die C&C-Domainnamen können allenfalls deaktiviert werden.

## Bedrohungslage – Cyber Espionage / Kill Chain

<table>
  <thead>
    <tr>
      <th style="text-align:left">#</th>
      <th style="text-align:left">Thema</th>
      <th style="text-align:left"></th>
      <th style="text-align:left">Mitigation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left">1</td>
      <td style="text-align:left">
        <p>Reconnaissance</p>
        <p>(Erkundung)</p>
      </td>
      <td style="text-align:left">
        <ul>
          <li>Nimmt eine Schlu&#x308;sselperson an einer Konferenz teil?</li>
          <li>Was fu&#x308;r Software wird eingesetzt?
            <ul>
              <li>Office Version? Microsoft Exchange? Phishing...</li>
            </ul>
          </li>
        </ul>
      </td>
      <td style="text-align:left"></td>
    </tr>
    <tr>
      <td style="text-align:left">2</td>
      <td style="text-align:left">
        <p>Weaponization</p>
        <p>(Bewaffnung)</p>
      </td>
      <td style="text-align:left">
        <ul>
          <li>Schwachstelle aussuchen, <a href="https://vuldb.com/">https://vuldb.com/</a>
          </li>
          <li>CVE-2018-8628 lesen, Tools besorgen</li>
        </ul>
      </td>
      <td style="text-align:left">Server- oder Applikationsversionen nicht nach aussen gegeben. z.B. Apache
        Konfiguration (ServerTokens)</td>
    </tr>
    <tr>
      <td style="text-align:left">3</td>
      <td style="text-align:left">Delivery</td>
      <td style="text-align:left">
        <ul>
          <li>SPAM / Phishing</li>
          <li>USB (RubberDucky, RaspberryPI)</li>
          <li>Supply Chain Attack (Bsp. ASUS Update Button), Kompromittierung von
            <ul>
              <li>Source Code eines Entwicklers</li>
              <li>
                <p>Compiler/Linker-Umgebungen</p>
                <p>(ASUS Update</p>
              </li>
              <li>Package Server (rpm&#x2019;s, python pip, ...)</li>
              <li>Update Server</li>
            </ul>
          </li>
        </ul>
      </td>
      <td style="text-align:left">
        <p>Awareness-Programme durchf&#xFC;hren,</p>
        <p>dass &quot;gefundene&quot; USB-Sticks nicht verwendet, sondern korrekt
          entsorgt werden sollen.</p>
      </td>
    </tr>
    <tr>
      <td style="text-align:left">4</td>
      <td style="text-align:left">Exploitation</td>
      <td style="text-align:left">
        <ul>
          <li>Escalation of Integrity</li>
          <li>EoP &#x2013; Escalation of Privilege</li>
        </ul>
      </td>
      <td style="text-align:left">Im Fall eines Exploits kann mittels entsprechender Sicherheitssoftware*
        ver- sucht werden, die Ausfu&#x308;hrung des Exploits zu verhindern. Im
        Fall einer &quot;Standalone&quot;-Applikation kann versucht werden, u&#x308;ber
        Application-Whitelisting* dessen Ausfu&#x308;hrung zu verhindern.</td>
    </tr>
    <tr>
      <td style="text-align:left">5</td>
      <td style="text-align:left">Installation</td>
      <td style="text-align:left">
        <ul>
          <li>Rootkit</li>
          <li>Ziel: Persistent einnisten</li>
        </ul>
      </td>
      <td style="text-align:left"></td>
    </tr>
    <tr>
      <td style="text-align:left">6</td>
      <td style="text-align:left">Command and Control (C&amp;C)</td>
      <td style="text-align:left">
        <ul>
          <li>Bulletproof Hoster / Bunker</li>
          <li>Bis Beh&#xF6;rden beim Server, alles schon formatiert</li>
        </ul>
      </td>
      <td style="text-align:left"></td>
    </tr>
    <tr>
      <td style="text-align:left">7</td>
      <td style="text-align:left">Actions on Objective</td>
      <td style="text-align:left">
        <ul>
          <li>Cyber Espionage</li>
        </ul>
      </td>
      <td style="text-align:left"></td>
    </tr>
  </tbody>
</table>
